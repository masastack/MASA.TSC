@inherits TscComponentBase

<AutoHeight AutoStyle="@($"max-height: calc(100vh - 185px);{Style}")">
    <HeaderContent>
        <div class="d-flex mb-6 @HeaderClass" style="@HeaderStyle">
            @HeaderContent
            <ServiceRelation Service="@ConfigurationRecord.Service"
                             Instance="@ConfigurationRecord.Instance"
                             Endpoint="@ConfigurationRecord.Endpoint"
                             ValueChanged="ServiceRelationChanged"
                             ModelType="ConfigurationRecord.ModelType" />
            <MSpacer />
            <DateTimeRangeToolbar Class="mr-6 my-auto" @bind-DefaultQuickRange="ConfigurationRecord.DefaultQuickRangeKey"
                                  StartTimeLimit="(val,end)=>val<=end&& val.AddDays(1)>=end"
                                  EndTimeLimit="(val,start)=>val>=start&&val.AddDays(-1)<=start"
                                  OnUpdate="OnDateTimeUpdateAsync"
                                  OnAutoUpdate="OnAutoDateTimeUpdateAsync" />
            <MTooltip Top>
                <ActivatorContent>
                    <div @attributes="@context.Attrs" @onclick="SwitchEdit" class="mr-6 my-auto d-flex">
                        <MSwitch Value="ConfigurationRecord.IsEdit" Readonly TValue="bool" LeftText="@T("V")" RightText="@T("E")" HideDetails="@("auto")" TrackColor="white" Color="primary" Class="my-auto" />
                    </div>
                </ActivatorContent>
                <ChildContent>
                    @if (ConfigurationRecord.IsEdit)
                    {
                        <span>@T("In edit mode, click to switch to view mode")</span>
                    }
                    else
                    {
                        <span>@T("In view mode, click to switch to edit mode")</span>
                    }
                </ChildContent>
            </MTooltip>
            <SButton Icon Class="mr-3 my-auto" Style="@(ConfigurationRecord.IsEdit ?"":"visibility:hidden;")" OnClick="AddPanel">
                <SIcon Tooltip="@T("Add Panel")" Size=28>@IconConstants.Chart</SIcon>
            </SButton>
            <SButton Icon Class="my-auto" Style="@(ConfigurationRecord.IsEdit ?"":"visibility:hidden;")" OnClick="SaveAsync">
                <SIcon Tooltip="@T("Save")" Size=28>@IconConstants.Save</SIcon>
            </SButton>
        </div>
    </HeaderContent>
    <AutoHeightContent>
        @if (_isLoading)
        {
            <LoadingData />
        }
        <DefaultCard Class="full-height pa-3">
            <CascadingValue Value="ConfigurationRecord.IsEdit" IsFixed>
                <CascadingValue Value="PanelGrids" IsFixed>
                    <CascadingValue Value="ConfigurationRecord" IsFixed>
                        <div id="@_scrollElementId" style="overflow-y:auto;overflow-x:hidden;" class="full-height">
                            @if (ConfigurationRecord.ServiceRelationReady(_serviceRelationReady) && _timeRangeReady)
                            {
                                <PanelGrids Panels="ConfigurationRecord.Panels" />
                            }
                            else
                            {
                                PanelGrids.RemoveAll(item => item.ParentPanel is null);
                            }
                            @if (_isAdd)
                            {
                                <div style="height:100000px;" />
                            }
                        </div>                     
                    </CascadingValue>
                </CascadingValue>
            </CascadingValue>
        </DefaultCard>
    </AutoHeightContent>
</AutoHeight>