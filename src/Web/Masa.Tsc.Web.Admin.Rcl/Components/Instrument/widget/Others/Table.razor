@namespace Masa.Tsc.Web.Admin.Rcl.Components

<MCard Height="410" Class="d-flex flex-column">
    <MCardTitle>
        <MLabel Class="emphasis2--text h6">@Title</MLabel>
    </MCardTitle>
    <MCardText Class="flex-grow-1" Style="overflow-y: auto;">
        <MSimpleTable>
            @if (Option.ShowTableHeader)
            {
                <thead>
                    <tr>
                        <th class="text-left">
                            Name
                        </th>
                        <th class="text-left">
                            Calories
                        </th>
                        @foreach (var field in Fields)
                        {
                            <th class="text-left">
                                @(string.IsNullOrWhiteSpace(field.Unit) ? @field.Name : $"{@field.Name}({field.Unit})")
                            </th>
                        }
                    </tr>
                </thead>
            }
            <tbody>
                @foreach (var item in _desserts)
                {
                    <tr @key="item.Name">
                        <td class="@($"text-{Option.ColumnAlignment}")">@item.Name</td>
                        <td class="@($"text-{Option.ColumnAlignment}")">@item.Calories</td>
                        @foreach (var field in Fields)
                        {
                            <td style="color:@field.Color" class="@($"text-{Option.ColumnAlignment}")">0.0</td>
                        }
                    </tr>
                }
            </tbody>
            @if (Option.ShowTableFooter)
            {
                <tfoot>
                    <tr>
                        <td>Sum</td>
                        <td>$180</td>
                    </tr>
                </tfoot>
            }
        </MSimpleTable>
        @if (Option.EnablePaginaton)
        {
            <MPagination Length="10" TotalVisible="5"></MPagination>
        }
    </MCardText>
</MCard>

<MCard Class="mt-6">
    <MCardText>
        <MRow>
            <MCol Md="6">
                <SSelect @bind-Value="@SystemIdentity" Items="_systemIdentities"
                         ItemText="item => item"
                         ItemValue="item => item" />
            </MCol>
            <MCol Md="6">
                <STextField @bind-Value="@Title" Label="Title" />
            </MCol>
            <MCol Md="12">
                <TableFieldMetrics @bind-Items="Fields"></TableFieldMetrics>
            </MCol>
        </MRow>
    </MCardText>
</MCard>

@code {
    [Parameter]
    public string Title { get; set; }

    [Parameter]
    public EventCallback<string> TitleChanged { get; set; }

    [Parameter]
    public string SystemIdentity { get; set; }

    [Parameter]
    public EventCallback<string> SystemIdentityChanged { get; set; }

    [Parameter]
    public List<TableFieldItemModel> Fields { get; set; } = new();

    [Parameter]
    public EventCallback<List<TableFieldItemModel>> FieldsChanged { get; set; }

    [Parameter]
    public TableOption Option { get; set; } = new();

    private List<string> _systemIdentities = new List<string>();

    protected override void OnInitialized()
    {
        base.OnInitialized();
    }

    public void StateUpdated()
    {
        StateHasChanged();
    }

    public class Dessert
    {
        public string Name { get; set; }

        public int Calories { get; set; }
    }

    private List<Dessert> _desserts = new List<Dessert>
        {
           new Dessert
           {
              Name= "Frozen Yogurt",
              Calories= 159
            },
            new Dessert
            {
              Name= "Ice cream sandwich",
              Calories= 237
            },
            new Dessert
            {
              Name= "Eclair",
              Calories= 262
            },
            new Dessert
            {
              Name= "Cupcake",
              Calories= 305
            },
            new Dessert
            {
                Name= "Gingerbread",
                Calories= 356
            },
            new Dessert
            {
                Name= "Jelly bean",
                Calories= 375
            },
            new Dessert
            {
                Name= "Lollipop",
                Calories= 392
            }
        };
}
