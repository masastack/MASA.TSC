@namespace Masa.Tsc.Web.Admin.Rcl.Components
@inherits TscComponentBase
<MContainer>
    @if (_isLoading)
    {
        <MRow>
            <MCol>
                Loading ...
            </MCol>
        </MRow>
    }
    else
    {
        <MRow>
            <MCol Cols="12">
                <MLabel>@_overView.Name</MLabel>
            </MCol>
        </MRow>
        <MRow>
            <MCol Class="py-0 my-0" Cols="2">
                <MAutocomplete Items="_overView.Services"
                           Dense
                           TItem=TraceOverviewServiceModel
                           TValue=string
                           ItemValue="item=>item.Name"
                           ItemText="item=>item.Name"
                           TItemValue=string @bind-Value="_overView.SearchName"></MAutocomplete>
            </MCol>
        </MRow>
        <MRow>
            <MCol Cols="12" Class="d-flex justify-start">
                <MCard Class="yellow rounded-md-1 body-2 ml-2  pt-1 px-6 rounded-md-1 blue-grey darken-1 white-text" Height="28">起始点 </MCard>
                <MCard Class="pl-2 pt-1 body-1" style="background:none" Height="28">@_overView.Start.Format(CurrentTimeZone)</MCard>
                <MCard Class="yellow rounded-md-1 body-2 ml-2  pt-1 px-6 rounded-md-1 blue-grey darken-1 white-text" Height="28">时间</MCard>
                <MCard Class="pl-2 pt-1 body-1" style="background:none" Height="28">@_overView.TimeUsString</MCard>
                <MCard Class="yellow rounded-md-1 body-2 ml-2  pt-1 px-6 rounded-md-1 blue-grey darken-1 white-text" Height="28">跨度</MCard>
                <MCard Class="pl-2 pt-1 body-1" style="background:none" Height="28">@_overView.Total</MCard>
            </MCol>
        </MRow>
        <MRow>
            <MCol Cols="12" Class="d-flex flex-wrap">
                @foreach (var item in _overView.Services)
                {
                    <MLabel Class="pa-2 mr-2 mb-2 rounded-lg" Style="@($"border:solid 1px {item.Color};color:{item.Color}")"><MIcon Class="pr-1" Color="@item.Color" XSmall>fas fa-cirle</MIcon>@item.Name</MLabel>
                }
            </MCol>
        </MRow>

        <MRow>
            <MCol Cols="8">
                <TreeTable Expand=true KeyFunc=@_keyFunc ParentFunc=@_parentFunc Items="_items" OnRowClick="OnChangeRecordAsync" OverViewData="_overView"></TreeTable>
            </MCol>
            <MCol Cols="4">
                <MContainer>
                    <MRow>
                        <MCol Cols=12>
                            <MCard Class="rounded-0">
                                <MCardText Class="pa-0 ma-0">
                                    @foreach (var item in _selectItem.Overview)
                                    {
                                        <MListItem Style="min-height:24px">@item.Value</MListItem>
                                    }
                                </MCardText>
                            </MCard>
                        </MCol>
                    </MRow>
                    <MRow>
                        <MCol Class="ma-0 py-0" Cols=12>
                            <MCard Class="rounded-0">
                                <MTabs SliderColor="gray" @bind-Value=_tabIndex>
                                    <MTab Value="@("attr")">属性</MTab>
                                    <MTab Value="@("resource")">资源</MTab>
                                    <MTab Value="@("detail")">详情</MTab>
                                    <MTab Value="@("log")">日志</MTab>
                                </MTabs>
                            </MCard>
                        </MCol>
                    </MRow>
                    <MRow>
                        <MCol Class="py-0" Cols=12>
                            <MTabsItems Value=@_tabIndex Style="border:1px solid gray;">
                                <MTabItem Value="@("attr")">
                                    <MCard>
                                        <MCardText Class="overflow-y-auto" Style="max-height:400px;">
                                            <TscKeyValue Value="_selectItem.Attributes" WordBreak=true></TscKeyValue>
                                        </MCardText>
                                    </MCard>
                                </MTabItem>
                                <MTabItem Value="@("resource")">
                                    <MCard>
                                        <MCardText Class="overflow-y-auto" Style="max-height:400px;">
                                            <TscKeyValue Value="_selectItem.Resources" WordBreak=true></TscKeyValue>
                                        </MCardText>
                                    </MCard>
                                </MTabItem>
                                <MTabItem Value="@("detail")">
                                    <MCard>
                                        <MCardText Class="overflow-y-auto" Style="max-height:400px;">
                                            <TscKeyValue Value="JsonSerializer.Deserialize<JsonElement>(JsonSerializer.Serialize(_selectItem.Current)).ToKeyValuePairs()" WordBreak=true></TscKeyValue>
                                        </MCardText>
                                    </MCard>
                                </MTabItem>
                                <MTabItem Value="@("log")">
                                    <MCard>
                                        <MCardText Class="overflow-y-auto" Style="max-height:400px;">
                                            <TscKeyValue Value="_selectItem.Logs" WordBreak=true></TscKeyValue>
                                        </MCardText>
                                    </MCard>
                                </MTabItem>
                            </MTabsItems>
                        </MCol>
                    </MRow>
                </MContainer>
            </MCol>
        </MRow>
    }
</MContainer>