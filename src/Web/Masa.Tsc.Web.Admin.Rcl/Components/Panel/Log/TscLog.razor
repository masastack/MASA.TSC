@namespace Masa.Tsc.Web.Admin.Rcl.Components
@inherits TscComponentBase

<MContainer Class="white">
    <MRow>
        <MCol Cols="12" Class="d-flex">
            <MCard Class="rounded-0" Height=38>
                <MCardText Class="py-2">                    
                    <SDateTimeRangePicker @bind-StartTime="_start" @bind-EndTime="_end" />
                </MCardText>
            </MCard>
            <MButton OnClick="QueryAsync" Height="38" Class="ml-4"><MIcon Size=20>fas fa-rotate</MIcon></MButton>
        </MCol>
    </MRow>

    <MRow Class="border-gray-thcik border-gray-thcik-top">
        <MCol Cols="12">
            <SearchTextField Label="请输入内容关键词" Outlined Class="rounded-0" @bind-Value="_queryStr" Dense Solo></SearchTextField>
        </MCol>
    </MRow>
    <MRow>
        <MCol Cols="12" Class="d-flex border-gray-thcik">
            <MSwitch Class="border-gray-thcik border-gray-thcik-top ma-0 pa-0" @bind-Value="_isWordBreak"
                     OnChange=UpdateWordBreakAsync
                     Label="NewLine" Dense Height=16>
            </MSwitch>
            <MButton Class="rounded-0" Outlined Height="38">时间<BIcon OnClick=UpdateSortingAsync>fas fa-sort</BIcon></MButton>
            <MCard Height="38" Class="rounded-0">
                <MCardText Class="pa-0">
                    <MAutocomplete Class="rounded-0"
                                   Items="_dicDurations"
                                   @bind-Value="_lastedDuration"
                                   TItem="KeyValuePair<int,string>"
                                   TValue="int"
                                   TItemValue="int"
                                   Dense
                                   Solo
                                   ItemText="item=>item.Value"
                                   ItemValue="item=>item.Key"
                                   OnSelectedItemUpdate=UpdateDurationAsync>
                        <MIcon>fa-sort-down</MIcon>
                    </MAutocomplete>
                </MCardText>
            </MCard>
        </MCol>
    </MRow>

    <MRow Class="pb-4">
        @if (_data is null)
        {
            <MCard Width="@("100%")" Class="text-center">@_msg</MCard>
        }
        else
        {
            <MContainer>
                @foreach (var item in _data)
                {
                    var keyValues = item.ToKeyValuePairs();
                    <MRow Class="rounded-md-4 border-gray-thcik">
                        <MCol Cols="2" Class="px-2" Style="text-align:justify" Md=2>@item.GetTimestamp().Value.Format(CurrentTimeZone)</MCol>
                        <MCol Cols="10" Class="my-1" Md=10><TscKeyValue Value=keyValues WordBreak="_isWordBreak"></TscKeyValue>  </MCol>
                    </MRow>
                }
            </MContainer>
        }
    </MRow>
    <MRow Class="d-flex justify-end">
        <MPagination Length=_totalPage TotalVisible=5 Value="_currentPage" ValueChanged=PageChangeAsync></MPagination>
    </MRow>
</MContainer>