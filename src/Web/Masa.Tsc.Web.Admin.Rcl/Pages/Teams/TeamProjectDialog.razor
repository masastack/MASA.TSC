@inherits TscComponentBase
@namespace Masa.Tsc.Web.Admin.Rcl.Components

<SSheetDialog Value=Visible OnClosed=DialogVisibleChanged Title="@Team?.CurrentProject?.Name" EnableDomReload>
    @if(Team is not null)
    {
        <MCard Style="background-color:#F0F3FA;border-top-left-radius: 20px;border-top-right-radius: 20px;" Class="full-height">
            <MRow NoGutters Class="full-height">
                <MCol Style="background-color:white;border-top-left-radius: 20px;" Cols="2" Class="d-flex flex-column justify-space-between pa-6 pb-9">
                    <ProjectDetail Value=@Team.CurrentProject></ProjectDetail>
                    <TeamDetail Value=@Team></TeamDetail>
                </MCol>
                <MCol Cols="10" Class="pa-9 full-height overflow-hidden">
                    <MRow Class="@Class">
                        <MCol Cols="6" Class="d-flex justify-start align-center">
                            <div style="width:210px;">
                                <ServiceAutoComplete Services="Apps" Value="@ConfigurationRecord.Service" ValueChanged="OnServiceChanged" @ref="ServiceAutoComplete" FillBackground=false />
                            </div>
                            <MChip Class="mx-6" Color="#05CD99" TextColor="white">@ServiceAutoComplete?.CurrentApp?.Type</MChip>
                            <MTooltip Top>
                                <ActivatorContent>
                                    <MLabel @attributes="@context.Attrs" Class="regular2--text body2" Style="max-width: 200px;white-space: nowrap;text-overflow: ellipsis;overflow: hidden;">
                                        @T("APPID"):@ServiceAutoComplete!.CurrentApp?.Identity
                                    </MLabel>
                                </ActivatorContent>
                                <ChildContent>
                                    <span>@ServiceAutoComplete!.CurrentApp?.Identity</span>
                                </ChildContent>
                            </MTooltip>
                        </MCol>
                        <MCol Cols="6" Class="d-flex justify-end align-center">
                            <DateTimeRangeToolbar 
                                StartTimeLimit="(val,end)=>val<=end&& val.AddMonths(1)>=end"
                                EndTimeLimit="(val,start)=>val>=start&&val.AddMonths(-1)<=start"
                                StartDateTime="@ConfigurationRecord.StartTime"
                                EndDateTime="@ConfigurationRecord.EndTime"
                                DefaultQuickRange="@ConfigurationRecord.DefaultQuickRangeKey"
                                Interval="@ConfigurationRecord.Interval"
                                UseAbsoluteTime="@ConfigurationRecord.UseAbsoluteTime"
                                OnUpdate="OnDateTimeUpdateAsync"
                                OnAutoUpdate="OnAutoDateTimeUpdateAsync" />
                            <SButton OnClick=NavigateToDashboardConfiguration Class="ml-6" Small BorderRadiusClass="rounded-lg">
                                @T("Show Detail")
                            </SButton>
                        </MCol>
                    </MRow>
                    <MRow Class="full-height overflow-y">
                    @if (ErrorCount > 0)
                    {
                        <MRow Class="pa-3">
                            <MCol Class="rounded-lg d-flex justify-space-between" Style="background-color:#FF5252">
                                <div class="d-flex align-center white--text"><MIcon Class="px-4" Color="white text-#FF5252">info</MIcon> @T("Currently the application has {0} error logs",ErrorCount.ToString())</div>
                                <MButton Depressed Color="white--text" Style="background-color:#FF5252;text-decoration:underline" OnClick="OpenLogAsync">@T("Show Detail")</MButton>
                            </MCol>
                        </MRow>
                    }
                    <ProjectCharts Class="mt-2" ConfigurationRecord="ConfigurationRecord" />
                    </MRow>
                </MCol>
            </MRow>
        </MCard>
    }
</SSheetDialog>